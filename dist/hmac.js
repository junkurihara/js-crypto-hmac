"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.compute=compute,exports.verify=verify;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_params=_interopRequireDefault(require("./params.js")),util=_interopRequireWildcard(require("./util.js"));/**
 * hmac.js
 */ /**
 * Compute keyed hash value
 * @param key
 * @param data
 * @param hash
 * @return {Promise<Uint8Array>}
 */function compute(){return _compute.apply(this,arguments)}/**
 * Verify HMAC
 * @param key
 * @param data
 * @param mac
 * @param hash
 * @return {Promise<boolean>}
 */function _compute(){return _compute=(0,_asyncToGenerator2.default)(/*#__PURE__*/_regenerator.default.mark(function a(b,c){var d,e,g,h,i,j,k,l,m,n,o,p,q,r=arguments;return _regenerator.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(d=2<r.length&&void 0!==r[2]?r[2]:"SHA-256",e=util.getWebCrypto(),g=util.getNodeCrypto(),h=util.getMsCrypto(),"undefined"==typeof e||"function"!=typeof e.importKey||"function"!=typeof e.sign){a.next=26;break}return a.prev=5,a.next=8,e.importKey("raw",b,{name:"HMAC",hash:{name:d}},!1,["sign","verify"]);case 8:return i=a.sent,a.next=11,e.sign("HMAC",i,c);case 11:return j=a.sent,a.abrupt("return",new Uint8Array(j));case 15:return a.prev=15,a.t0=a["catch"](5),a.next=19,e.importKey("raw",b,{name:"HMAC",hash:{name:d}},!1,["sign","verify"]);case 19:return k=a.sent,a.next=22,e.sign({name:"HMAC",hash:{name:d}},k,c);case 22:return l=a.sent,a.abrupt("return",new Uint8Array(l));case 24:a.next=44;break;case 26:if("undefined"==typeof g){a.next=31;break}return m=g.createHmac(_params.default.hashes[d].nodeName,b),a.abrupt("return",new Uint8Array(m.update(c).digest()));case 31:if("undefined"==typeof h||"function"!=typeof h.importKey||"function"!=typeof h.sign){a.next=43;break}return n=function(a,b,c,d,e){return new Promise(function(f){var g=h.importKey(a,b,c,d,e);g.oncomplete=function(a){f(a.target.result)}})},o=function(a,b,c){return new Promise(function(d){var e=h.sign({name:"HMAC",hash:{name:a}},b,c);e.oncomplete=function(a){d(new Uint8Array(a.target.result))}})},a.next=36,n("raw",b,{name:"HMAC",hash:{name:d}},!1,["sign","verify"]);case 36:return p=a.sent,a.next=39,o(d,p,c);case 39:return q=a.sent,a.abrupt("return",new Uint8Array(q));case 43:throw new Error("UnsupportedEnvironment");case 44:case"end":return a.stop();}},a,this,[[5,15]])})),_compute.apply(this,arguments)}function verify(){return _verify.apply(this,arguments)}function _verify(){return _verify=(0,_asyncToGenerator2.default)(/*#__PURE__*/_regenerator.default.mark(function a(b,c,d){var e,f,g=arguments;return _regenerator.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e=3<g.length&&void 0!==g[3]?g[3]:"SHA-256",d instanceof Uint8Array){a.next=3;break}throw new Error("InvalidInputMac");case 3:return a.next=5,compute(b,c,e);case 5:return f=a.sent,a.abrupt("return",d.toString()===f.toString());case 7:case"end":return a.stop();}},a,this)})),_verify.apply(this,arguments)}